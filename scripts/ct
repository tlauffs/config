#!/bin/bash

# Function to start or attach to a tmux session
dir=$(zoxide query -i "$1")

# Check if zoxide found a directory
if [ -z "$dir" ]; then
  echo "No directory found for: $1"
  exit 1
fi

# Get the last folder name for the session name
session_name=$(basename "$dir")

# Check if already in a tmux session
if [ -n "$TMUX" ]; then
  # Try to switch to the existing session
  if tmux has-session -t "$session_name" 2>/dev/null; then
    tmux switch-client -t "$session_name"
  else
    # detach to avoid nesting
    tmux detach
    # Create a new session in the specified directory
    tmux new- -s "$session_name" -c "$dir"
  fi
else
  # Create or attach to a tmux session in the directory
  tmux new -As "$session_name" -c "$dir"
fi
